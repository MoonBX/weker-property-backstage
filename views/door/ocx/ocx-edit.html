<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN""http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- saved from url=(0014)about:internet-->

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>读写器测试(Javascript)</title>
  <link rel="stylesheet" href="jquery.toast.min.css">
  <script src="jquery.min.js"></script>
  <script src="jquery.toast.min.js"></script>
  <script language="javascript" src="http://127.0.0.1:8008/YOWOCloudRFIDReader.js"></script>
</head>

<script>
  try {
    var rfidreader = YOWORFIDReader.createNew();
  } catch (e) {
    alert("创建读卡器连接失败，请先下载安装！");
    top.location = "http://www.youwokeji.com.cn/CloudReader/YOWORFIDReaderCloudForWeb.exe";
  }
  if (!rfidreader.TryConnect()) {
    alert("浏览器不支持，请更换浏览器后重试！");
  }

  window.onload = function () {
    var val = parent.document.getElementById("CardTypeName").value;
    var arr = val.split(" ");
    arr.pop();
    if(arr.length){
      for (var l = 0; l < arr.length; l++) {
        $('.cards-box').append('<div class="row m-b-sm"> <label class="w-label-control" style="width:40px;">卡' + (l + 1) + ':</label> <input type="search" class="w-sm p-h-xs m-r-md pull-left w-form-control" name="CardNo' + l + '" id="CardNo' + l + '" value="'+arr[l]+'"></div>');
      }
    }else{
      $('.cards-box').append('<div class="row m-b-sm"> <label class="w-label-control" style="width:40px;">卡1:</label> <input type="search" class="w-sm p-h-xs m-r-md pull-left w-form-control" name="CardNo0" id="CardNo0"></div>');
    }
  }

  rfidreader.onResult(function (resultdata) {
    var cardBox = $('.cards-box');
    var currentIndex = cardBox.children(".row").length - 1;
    var firstInput = cardBox.children(".row").eq(0).children("input")[0].value;
    var length = cardBox.children(".row").length;

    switch (resultdata.FunctionID) {

      case 0:
        if (resultdata.Result > 0) {
          for (var k = 0; k < length; k++) {
            if ("IC-" + resultdata.strData.slice(2) == cardBox.children(".row").eq(k).children("input")[0].value) {
              length = 0;
              test('重复读卡')
              break;
            }
          }

          for (var j = 0; j < length; j++) {
            if ("IC-" + resultdata.strData.slice(2) == cardBox.children(".row").eq(j).children("input")[0].value) {
              test('重复读卡');
              length = 0;
              break;
            }

            if (!cardBox.children(".row").eq(j).children("input")[0].value) {
              document.getElementById("CardNo" + j).value = "IC-" + resultdata.strData.slice(2);
              break;
            }

            if (j == cardBox.children(".row").length - 1) {
              if (!firstInput && currentIndex == 0) {
                document.getElementById("CardNo0").value = "IC-" + resultdata.strData.slice(2);
              } else if (firstInput && currentIndex == 0) {
                cardBox.append('<div class="row m-b-sm"> <label class="w-label-control" style="width:40px;">卡2:</label> <input type="search" class="w-sm p-h-xs m-r-md pull-left w-form-control" name="CardNo1" id="CardNo1"></div>');
                document.getElementById("CardNo1").value = "IC-" + resultdata.strData.slice(2);
              } else if (currentIndex > 0 && currentIndex < 9) {
//            console.log(currentIndex);
                cardBox.append('<div class="row m-b-sm"> <label class="w-label-control" style="width:40px;">卡' + (currentIndex + 2) + ':</label> <input type="search" class="w-sm p-h-xs m-r-md pull-left w-form-control" name="CardNo' + (currentIndex + 1) + '" id="CardNo' + (currentIndex + 1) + '"></div>');
                document.getElementById("CardNo" + (currentIndex + 1)).value = "IC-" + resultdata.strData.slice(2);
              } else {
                console.log('end');
              }
            }
          }
        }else{
          test('读卡失败')
        }
        break;
    }
  });

  function Start() {
    var OrderID = 0;
    var FormatID = 1;
    rfidreader.Repeat = 0;
    rfidreader.HaltAfterSuccess = 0;
    rfidreader.BeepOnSuccess = 0;
    rfidreader.RequestTypeACardNo(FormatID, OrderID);
  }

  function test(text) {
    $.toast({
      text: text,
      hideAfter: 1000,
      loader: false
    })
  }
</script>

<body>
<style>
  .other-info .title {
    margin-right: 10px;
    display: inline-block;
    width: 70px;
    text-align: right;
    color: #999999;
  }

  .p-v-md {
    padding-top: 20px;
    padding-bottom: 20px
  }

  .p-h-sm {
    padding-right: 10px;
    padding-left: 10px
  }

  .p-sm {
    padding: 10px;
  }

  .pull-left {
    float: left;
  }

  .m-b-sm {
    margin-bottom: 10px;
  }

  .w-label-control {
    float: left;
    text-align: right;
    margin-top: 5px;
    margin-right: 10px;
  }

  .row {
    width: 100%;
    display: inline-block;
  }

  .w-form-control {
    color: #555;
    border: 1px solid #ccc;
    width: 120px;
    height: 28px;
    padding: 0;
    font-size: 13px;
    outline: none;
    padding-left: 6px;
    -webkit-transition: border-color ease-in-out .15s, -webkit-box-shadow ease-in-out .15s;
    -o-transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
    transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
  }

  .w-form-control:focus {
    border-color: #acb2b8;
    padding-left: 6px;
  }

  .m-r-md {
    margin-right: 20px
  }

  .cards-box {
    background: #F0F6FF;
    width: 400px;
    height: 200px;
    /*display: flex;*/
    /*-ms-display: flex;*/
    /*flex-direction: row;*/
    /*flex-wrap: wrap;*/
  }

  .cards-box .row {
    /*flex-grow: 0;*/
    float: left;
    width: 50%;
  }

  .clear {
    text-decoration: none;
    font-size: 12px;
    line-height: 30px;
  }

  .btn {
    display: inline-block;
    padding: 6px 12px;
    font-size: 14px;
    line-height: 1.4285;
    text-align: center;
    white-space: nowrap;
    vertical-align: middle;
    cursor: pointer;
    border: 1px solid transparent;
  }

  .p-h-lg {
    padding-right: 30px;
    padding-left: 30px;
  }

  .m-b-md {
    margin-bottom: 20px;
  }

  .btn-primary:hover, .btn-primary:focus {
    color: #ffffff !important;
    background-color: #4E85DE !important;
    border-color: #4E85DE !important;
  }

  .btn-primary {
    color: #ffffff !important;
    background-color: #4E85DE !important;
    border-color: #4E85DE !important;
  }
  .text-center{
    text-align: center;
  }
</style>
<div class="other-info p-v-md p-h-sm clearfix">
  <div class="pull-left p-sm cards-box" id="cardBox"></div>
  <div class="text-center p-h-sm" style="width: auto; overflow: auto">
    <button class="btn btn-primary btn-md p-h-lg m-b-md" name="RequestCard1" value="寻卡" onClick="Start()">读取卡号
    </button>
    <div class="m-b-md"><a href="http://www.youwokeji.com.cn/CloudReader/YOWORFIDReaderCloudForWeb.exe">下载插件</a></div>
  </div>
</div>
</body>


</html>